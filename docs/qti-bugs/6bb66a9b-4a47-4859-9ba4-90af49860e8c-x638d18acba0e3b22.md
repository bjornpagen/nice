# Identify the table that matches a double number line

- **analysisId**: 6bb66a9b-4a47-4859-9ba4-90af49860e8c
- **questionId**: x638d18acba0e3b22
- **severity**: major

### Issue
The top and bottom lines (i.e., "Games" and "Cost (dollars)" respectively) are too close together and thus are overlapping due to the lack of vertical space between them. The tables for the answer choices are not rendering as tables.

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "The number lines show that the ratio of $\\blueE{\\text{games}}$ to $\\maroonD{\\text{dollars}}$ is $\\blueE1:\\maroonD{14}$.\n\nWe are looking for a table that has ratios that are equivalent to $\\blueE1:\\maroonD{14}$.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "\n\n\n\n[[☃ image 1]]\n\nThe ratio of $\\blueE1:\\maroonD{14}$ is equivalent to $\\blueE{2}:\\maroonD{28}$.",
      "replace": false,
      "widgets": {
        "image 1": {
          "type": "image",
          "graded": true,
          "static": false,
          "options": {
            "alt": "A double number line with 3 unequally spaced tick marks. The values in the second number line, labeled Cost (dollars), are 14 times the corresponding values in the first number line, labeled Games. The line labeled Games, reads from left to right: 0, 1, 2. The line labeled Cost (dollars), reads from left to right: 0, 14, 28. An arrow from the pair 1 to 14 to the pair 2 to 28 is labeled times 2.",
            "box": [
              350,
              200
            ],
            "range": [
              [
                0,
                10
              ],
              [
                0,
                10
              ]
            ],
            "title": "",
            "labels": [],
            "static": false,
            "caption": "",
            "backgroundImage": {
              "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/aa8b8847aa3fcb7fc39e16bb40cf28d2be8f6912",
              "width": 350,
              "height": 200
            }
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "block"
        }
      }
    },
    {
      "images": {},
      "content": "\n\n[[☃ image 1]]\n\nThe ratio of $\\blueE1:\\maroonD{14}$ is equivalent to $\\blueE{4}:\\maroonD{56}$.",
      "replace": false,
      "widgets": {
        "image 1": {
          "type": "image",
          "graded": true,
          "static": false,
          "options": {
            "alt": "A double number line with 4 unequally spaced tick marks. The values in the second number line, labeled Cost (dollars), are 14 times the corresponding values in the first number line, labeled Games. The line labeled Games, reads from left to right: 0, 1, 2, 4. The line labeled Cost (dollars), reads from left to right: 0, 14, 28, 56. An arrow from the pair 1 to 14 to the pair 4 to 56 is labeled times 4.",
            "box": [
              350,
              200
            ],
            "range": [
              [
                0,
                10
              ],
              [
                0,
                10
              ]
            ],
            "title": "",
            "labels": [],
            "static": false,
            "caption": "",
            "backgroundImage": {
              "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/49c8335c08a493c0c18d2928d864798e56ba2d4c",
              "width": 350,
              "height": 200
            }
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "block"
        }
      }
    },
    {
      "images": {},
      "content": "\n[[☃ image 1]]\n\nThe ratio of $\\blueE1:\\maroonD{14}$ is equivalent to $\\blueE{7}:\\maroonD{98}$.",
      "replace": false,
      "widgets": {
        "image 1": {
          "type": "image",
          "graded": true,
          "static": false,
          "options": {
            "alt": "A double number line with 5 unequally spaced tick marks. The values in the second number line, labeled Cost (dollars), are 14 times the corresponding values in the first number line, labeled Games. The line labeled Games, reads from left to right: 0, 1, 2, 4, 7. The line labeled Cost (dollars), reads from left to right: 0, 14, 28, 56, 98. An arrow from the pair 1 to 14 to the pair 7 to 98 is labeled times 7.",
            "box": [
              350,
              200
            ],
            "range": [
              [
                0,
                10
              ],
              [
                0,
                10
              ]
            ],
            "title": "",
            "labels": [],
            "static": false,
            "caption": "",
            "backgroundImage": {
              "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/7aff5acf9db720559ba1b7a8ded0476e89ea2958",
              "width": 350,
              "height": 200
            }
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "block"
        }
      }
    },
    {
      "images": {},
      "content": "Here is the table that represents the cost per game of bowling:\n\nGames | Cost (dollars)\n:-: | :-: \n$2$ | $28$\n$4$| $56$\n$7$ | $98$",
      "replace": false,
      "widgets": {}
    }
  ],
  "question": {
    "images": {},
    "content": "The double number line shows that $1$ game of bowling costs $14$ dollars.\n\n\n\n[[☃ image 1]]\n\n**Which table represents the cost per game of bowling?** \n\n[[☃ radio 1]]",
    "widgets": {
      "image 1": {
        "type": "image",
        "graded": true,
        "static": false,
        "options": {
          "alt": "A double number line with 2 tick marks on each number line. The values in the second number line, labeled Cost (dollars), are 14 times the corresponding values in the first number line, labeled Games. The number line labeled Games reads from left to right: 0 and 1. The number line labeled Cost (dollars) reads from left to right: 0 and 14.",
          "box": [
            350,
            120
          ],
          "range": [
            [
              0,
              10
            ],
            [
              0,
              10
            ]
          ],
          "title": "",
          "labels": [],
          "static": false,
          "caption": "",
          "backgroundImage": {
            "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/772d3fa7e5436aaba06fc34381c1282ccdc67a1d",
            "width": 350,
            "height": 120
          }
        },
        "version": {
          "major": 0,
          "minor": 0
        },
        "alignment": "block"
      },
      "radio 1": {
        "type": "radio",
        "graded": true,
        "static": false,
        "options": {
          "choices": [
            {
              "content": "Games | Cost (dollars)\n:-: | :-: \n$3$ | $42$\n$5$| $60$\n$6$ | $74$",
              "correct": false
            },
            {
              "content": "Games | Cost (dollars)\n:-: | :-: \n$2$ | $28$\n$4$| $56$\n$7$ | $98$",
              "correct": true
            }
          ],
          "randomize": false,
          "countChoices": false,
          "displayCount": null,
          "multipleSelect": false,
          "deselectEnabled": false,
          "hasNoneOfTheAbove": false
        },
        "version": {
          "major": 1,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "The double number line shows that "
        },
        {
          "type": "math",
          "mathml": "<mn>1</mn>"
        },
        {
          "type": "text",
          "content": " game of bowling costs "
        },
        {
          "type": "math",
          "mathml": "<mn>14</mn>"
        },
        {
          "type": "text",
          "content": " dollars."
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "image_1"
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Which table represents the cost per game of bowling?"
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "choice_interaction"
    }
  ],
  "title": "Identify the table that matches a double number line",
  "widgets": {
    "image_1": {
      "type": "doubleNumberLine",
      "width": 350,
      "height": 120,
      "topLine": {
        "label": "Games",
        "ticks": [
          0,
          1
        ]
      },
      "bottomLine": {
        "label": "Cost (dollars)",
        "ticks": [
          0,
          14
        ]
      }
    }
  },
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Correct! The double number line shows a ratio of "
          },
          {
            "type": "math",
            "mathml": "<mn>1</mn><mo>:</mo><mn>14</mn>"
          },
          {
            "type": "text",
            "content": ", so each number of games is multiplied by "
          },
          {
            "type": "math",
            "mathml": "<mn>14</mn>"
          },
          {
            "type": "text",
            "content": " to get the cost. The correct table includes the equivalent ratios "
          },
          {
            "type": "math",
            "mathml": "<mn>2</mn><mo>:</mo><mn>28</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>4</mn><mo>:</mo><mn>56</mn>"
          },
          {
            "type": "text",
            "content": ", and "
          },
          {
            "type": "math",
            "mathml": "<mn>7</mn><mo>:</mo><mn>98</mn>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Not quite. Use the ratio from the number line: "
          },
          {
            "type": "math",
            "mathml": "<mn>1</mn><mo>:</mo><mn>14</mn>"
          },
          {
            "type": "text",
            "content": ". Multiply the number of games by "
          },
          {
            "type": "math",
            "mathml": "<mn>14</mn>"
          },
          {
            "type": "text",
            "content": " to find the cost. Look for a table that contains values like "
          },
          {
            "type": "math",
            "mathml": "<mn>2</mn><mo>:</mo><mn>28</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>4</mn><mo>:</mo><mn>56</mn>"
          },
          {
            "type": "text",
            "content": ", and "
          },
          {
            "type": "math",
            "mathml": "<mn>7</mn><mo>:</mo><mn>98</mn>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      }
    ]
  },
  "identifier": "bowling-cost-table",
  "interactions": {
    "choice_interaction": {
      "type": "choiceInteraction",
      "prompt": [
        {
          "type": "text",
          "content": "Which table represents the cost per game of bowling?"
        }
      ],
      "choices": [
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "Games | Cost (dollars)"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "3 | 42"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "5 | 60"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "6 | 74"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "A"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "Games | Cost (dollars)"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "2 | 28"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "4 | 56"
                }
              ]
            },
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "7 | 98"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "B"
        }
      ],
      "shuffle": true,
      "maxChoices": 1,
      "minChoices": 1,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": "B",
      "baseType": "identifier",
      "identifier": "RESPONSE",
      "cardinality": "single"
    }
  ]
}
```

### Relevant code
- Response normalization — src/lib/qti-generation/response-processor.ts
```
import { isTerminatingFraction } from "./helpers"
import type { AssessmentItem } from "./schemas"

export function compileResponseDeclarations(decls: AssessmentItem["responseDeclarations"]): string {
	// Guardrail: ensure identifier-base declarations use choice identifiers, not labels
	for (const decl of decls) {
		if (decl.baseType === "identifier") {
			const correctValues = Array.isArray(decl.correct) ? decl.correct : [decl.correct]
			const offending = correctValues.filter((v): v is string => typeof v === "string" && /\s/.test(v))
			if (offending.length > 0) {
				logger.error("identifier response contains non-identifier values", {
					responseIdentifier: decl.identifier,
					offending
				})
				throw errors.new(
					`response '${decl.identifier}' expects choice identifier(s); found label-like value(s): [${offending.join(", ")}]`
				)
			}
		}
	}

	// Pre-process declarations to add equivalent numeric mappings.
	return decls
		.map((decl) => {
			const correctValues = Array.isArray(decl.correct) ? decl.correct : [decl.correct]
			const allCorrectValues = new Set<string | number>(correctValues)

			for (const val of correctValues) {
				if (typeof val !== "string") continue

				if (val.startsWith(".")) allCorrectValues.add(`0${val}`)
				else if (val.startsWith("0.")) allCorrectValues.add(val.substring(1))

				// Rule: Allow implicit multiplication between a leading numeric coefficient and parentheses
				// e.g., 25*(p+2q) -> also accept 25(p+2q)
				{
					const implicitAlt = val.replace(/(\d+)\s*\*\s*\(/g, "$1(")
					if (implicitAlt !== val) {
						allCorrectValues.add(implicitAlt)
					}
				}

				if (val.includes("/") && !val.startsWith(".")) {
					const parts = val.split("/")
					if (parts.length === 2 && parts[0] && parts[1]) {
						const num = Number.parseInt(parts[0], 10)
```

- Widget registry — src/lib/widgets/generators/index.ts
```
import { generateVennDiagram, VennDiagramPropsSchema } from "./venn-diagram"
import { generateVerticalArithmeticSetup, VerticalArithmeticSetupPropsSchema } from "./vertical-arithmetic-setup"

// The `type` field is now included in the base schemas, so we remove .extend()
export const typedSchemas = {
	"3dIntersectionDiagram": ThreeDIntersectionDiagramPropsSchema,
	absoluteValueNumberLine: AbsoluteValueNumberLinePropsSchema,
	angleDiagram: AngleDiagramPropsSchema,
	barChart: BarChartPropsSchema,
	boxGrid: BoxGridPropsSchema,
	boxPlot: BoxPlotPropsSchema,
	circleDiagram: CircleDiagramPropsSchema,
	compositeShapeDiagram: CompositeShapeDiagramPropsSchema,
	coordinatePlane: CoordinatePlaneComprehensivePropsSchema,
	distanceFormulaGraph: DistanceFormulaGraphPropsSchema,
	functionPlotGraph: FunctionPlotGraphPropsSchema,
	lineEquationGraph: LineEquationGraphPropsSchema,
	pointPlotGraph: PointPlotGraphPropsSchema,
	polygonGraph: PolygonGraphPropsSchema,
	shapeTransformationGraph: ShapeTransformationGraphPropsSchema,
	dataTable: DataTablePropsSchema,
	discreteObjectRatioDiagram: DiscreteObjectRatioDiagramPropsSchema,
	dotPlot: DotPlotPropsSchema,
	doubleNumberLine: DoubleNumberLinePropsSchema,
	emojiImage: EmojiImagePropsSchema,
	figureComparisonDiagram: FigureComparisonDiagramPropsSchema,
	fractionNumberLine: FractionNumberLinePropsSchema,
	geometricSolidDiagram: GeometricSolidDiagramPropsSchema,
	hangerDiagram: HangerDiagramPropsSchema,
	histogram: HistogramPropsSchema,
	inequalityNumberLine: InequalityNumberLinePropsSchema,
	numberLine: NumberLinePropsSchema,
	numberLineForOpposites: NumberLineForOppositesPropsSchema,
	numberLineWithAction: NumberLineWithActionPropsSchema,
	numberLineWithFractionGroups: NumberLineWithFractionGroupsPropsSchema,
	numberSetDiagram: NumberSetDiagramPropsSchema,
	partitionedShape: PartitionedShapePropsSchema,
	pentagonIntersectionDiagram: PentagonIntersectionDiagramPropsSchema,
	pictograph: PictographPropsSchema,
	polyhedronDiagram: PolyhedronDiagramPropsSchema,
	probabilitySpinner: ProbabilitySpinnerPropsSchema,
	polyhedronNetDiagram: PolyhedronNetDiagramPropsSchema,
	pythagoreanProofDiagram: PythagoreanProofDiagramPropsSchema,
	ratioBoxDiagram: RatioBoxDiagramPropsSchema,
	rectangularFrameDiagram: RectangularFrameDiagramPropsSchema,
	scaleCopiesSlider: ScaleCopiesSliderPropsSchema,
```

- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```
