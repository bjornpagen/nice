# Classify the number 8/2

- **analysisId**: a623a274-b94c-4e89-a544-d81f9216ee45
- **questionId**: x6255669b3d9ab6d6
- **severity**: major

### Issue
There is a diagram for the overlap between domains of numbers (e.g., rational numbers, integers) that is not present in the original. The question "What type of number is 8/2?" is repeated.

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "The following diagram shows that all whole numbers are integers, and all integers are rational numbers. Numbers that are not rational are called irrational. \n\n\n[[☃ image 1]]\n\n",
      "replace": false,
      "widgets": {
        "image 1": {
          "type": "image",
          "graded": true,
          "static": false,
          "options": {
            "alt": "4 oval shapes representing different groups of numbers.  Three of the oval shapes are embedded within one another. The oval shape labeled rational numbers contains the oval shape labeled integers, which contains the oval shape labeled whole numbers. The separate oval shape labeled Irrational numbers is to the right.",
            "box": [
              474,
              180
            ],
            "range": [
              [
                0,
                10
              ],
              [
                0,
                10
              ]
            ],
            "title": "",
            "labels": [],
            "static": false,
            "caption": "",
            "backgroundImage": {
              "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/3847ed60b4216b14d20e21e161b45eb0ff7a4149",
              "width": 474,
              "height": 180
            }
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "block"
        }
      }
    },
    {
      "images": {},
      "content": "$\\green{\\text{Whole numbers}}$ are numbers that don't need to be represented with a fraction or decimal.  Also, whole numbers cannot be negative.\n\n$\\blue{\\text{Integers}}$ are whole numbers but can also be negative.\n\n$\\purple{\\text{Rational numbers}}$ are numbers that can be expressed as a fraction of two integers. Keep in mind that the denominator cannot be equal to $0$!\n\n$\\pink{\\text{Irrational numbers}}$ are numbers that *cannot* be expressed as a fraction of two integers.\n",
      "widgets": {}
    },
    {
      "images": {},
      "content": "Now, let's answer the question. Notice that $\\dfrac{8}{2} = 4$.\n\n> $\\dfrac8{2}$ is a whole number because it is not negative and doesn't need to be represented with a fraction or decimal.\n\n>$\\dfrac8{2}$ is also an integer and a rational number because all whole numbers are integers and rational numbers.",
      "widgets": {}
    },
    {
      "images": {},
      "content": "The following number types apply to $\\dfrac8{2}$ :\n\n- Whole number\n- Integer\n- Rational",
      "widgets": {}
    }
  ],
  "question": {
    "images": {},
    "content": "**What type of number is $\\dfrac8{2}$?**\n\n[[☃ radio 1]]\n\n",
    "widgets": {
      "radio 1": {
        "type": "radio",
        "graded": true,
        "options": {
          "choices": [
            {
              "content": "Whole number",
              "correct": true
            },
            {
              "content": "Integer",
              "correct": true
            },
            {
              "content": "Rational",
              "correct": true
            },
            {
              "content": "Irrational"
            }
          ],
          "randomize": false,
          "onePerLine": true,
          "displayCount": null,
          "multipleSelect": true,
          "deselectEnabled": false,
          "hasNoneOfTheAbove": false
        },
        "version": {
          "major": 1,
          "minor": 0
        }
      }
    }
  },
  "answerArea": {
    "type": "multiple",
    "options": {
      "images": {},
      "content": "",
      "widgets": {}
    },
    "calculator": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "The diagram shows relationships among whole numbers, integers, rational numbers, and irrational numbers."
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "number_sets_diagram"
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "What type of number is "
        },
        {
          "type": "math",
          "mathml": "<mfrac><mn>8</mn><mn>2</mn></mfrac>"
        },
        {
          "type": "text",
          "content": "?"
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "choice_interaction"
    }
  ],
  "title": "Classify the number 8/2",
  "widgets": {
    "number_sets_diagram": {
      "sets": {
        "whole": {
          "color": "#28ae7b",
          "label": "Whole numbers"
        },
        "integer": {
          "color": "#6495ed",
          "label": "Integers"
        },
        "rational": {
          "color": "#9d38bd",
          "label": "Rational numbers"
        },
        "irrational": {
          "color": "#ff00af",
          "label": "Irrational numbers"
        }
      },
      "type": "numberSetDiagram",
      "width": 474,
      "height": 180
    }
  },
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mfrac><mn>8</mn><mn>2</mn></mfrac><mo>=</mo><mn>4</mn>"
          },
          {
            "type": "text",
            "content": ", which is a whole number. All whole numbers are integers and rational numbers, so the correct choices are Whole number, Integer, and Rational."
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mfrac><mn>8</mn><mn>2</mn></mfrac><mo>=</mo><mn>4</mn>"
          },
          {
            "type": "text",
            "content": ". A whole number does not need to be represented with a fraction or decimal and is not negative. All whole numbers are also integers and rational numbers."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Definitions:"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "• Whole numbers: nonnegative numbers that do not require fractions or decimals."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "• Integers: all whole numbers and their negatives."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "• Rational numbers: numbers that can be written as a fraction of two integers with a nonzero denominator (denominator "
          },
          {
            "type": "math",
            "mathml": "<mo>≠</mo><mn>0</mn>"
          },
          {
            "type": "text",
            "content": ")."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "• Irrational numbers: numbers that cannot be expressed as a fraction of two integers."
          }
        ]
      }
    ]
  },
  "identifier": "classify-number-8-over-2",
  "interactions": {
    "choice_interaction": {
      "type": "choiceInteraction",
      "prompt": [
        {
          "type": "text",
          "content": "What type of number is "
        },
        {
          "type": "math",
          "mathml": "<mfrac><mn>8</mn><mn>2</mn></mfrac>"
        },
        {
          "type": "text",
          "content": "?"
        }
      ],
      "choices": [
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "Whole number"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "A"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "Integer"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "B"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "Rational"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "C"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "Irrational"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "D"
        }
      ],
      "shuffle": true,
      "maxChoices": 4,
      "minChoices": 1,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": [
        "A",
        "B",
        "C"
      ],
      "baseType": "identifier",
      "identifier": "RESPONSE",
      "cardinality": "multiple"
    }
  ]
}
```

### Relevant code
- Widget registry — src/lib/widgets/generators/index.ts
```
import { generateVennDiagram, VennDiagramPropsSchema } from "./venn-diagram"
import { generateVerticalArithmeticSetup, VerticalArithmeticSetupPropsSchema } from "./vertical-arithmetic-setup"

// The `type` field is now included in the base schemas, so we remove .extend()
export const typedSchemas = {
	"3dIntersectionDiagram": ThreeDIntersectionDiagramPropsSchema,
	absoluteValueNumberLine: AbsoluteValueNumberLinePropsSchema,
	angleDiagram: AngleDiagramPropsSchema,
	barChart: BarChartPropsSchema,
	boxGrid: BoxGridPropsSchema,
	boxPlot: BoxPlotPropsSchema,
	circleDiagram: CircleDiagramPropsSchema,
	compositeShapeDiagram: CompositeShapeDiagramPropsSchema,
	coordinatePlane: CoordinatePlaneComprehensivePropsSchema,
	distanceFormulaGraph: DistanceFormulaGraphPropsSchema,
	functionPlotGraph: FunctionPlotGraphPropsSchema,
	lineEquationGraph: LineEquationGraphPropsSchema,
	pointPlotGraph: PointPlotGraphPropsSchema,
	polygonGraph: PolygonGraphPropsSchema,
	shapeTransformationGraph: ShapeTransformationGraphPropsSchema,
	dataTable: DataTablePropsSchema,
	discreteObjectRatioDiagram: DiscreteObjectRatioDiagramPropsSchema,
	dotPlot: DotPlotPropsSchema,
	doubleNumberLine: DoubleNumberLinePropsSchema,
	emojiImage: EmojiImagePropsSchema,
	figureComparisonDiagram: FigureComparisonDiagramPropsSchema,
	fractionNumberLine: FractionNumberLinePropsSchema,
	geometricSolidDiagram: GeometricSolidDiagramPropsSchema,
	hangerDiagram: HangerDiagramPropsSchema,
	histogram: HistogramPropsSchema,
	inequalityNumberLine: InequalityNumberLinePropsSchema,
	numberLine: NumberLinePropsSchema,
	numberLineForOpposites: NumberLineForOppositesPropsSchema,
	numberLineWithAction: NumberLineWithActionPropsSchema,
	numberLineWithFractionGroups: NumberLineWithFractionGroupsPropsSchema,
	numberSetDiagram: NumberSetDiagramPropsSchema,
	partitionedShape: PartitionedShapePropsSchema,
	pentagonIntersectionDiagram: PentagonIntersectionDiagramPropsSchema,
	pictograph: PictographPropsSchema,
	polyhedronDiagram: PolyhedronDiagramPropsSchema,
	probabilitySpinner: ProbabilitySpinnerPropsSchema,
	polyhedronNetDiagram: PolyhedronNetDiagramPropsSchema,
	pythagoreanProofDiagram: PythagoreanProofDiagramPropsSchema,
	ratioBoxDiagram: RatioBoxDiagramPropsSchema,
	rectangularFrameDiagram: RectangularFrameDiagramPropsSchema,
	scaleCopiesSlider: ScaleCopiesSliderPropsSchema,
```

- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```

### Root cause analysis
- Widget generators lack fine-grained layout controls for label spacing, tick sizing, and overlays (e.g., best-fit lines).
- Some required annotations (e.g., heights, arcs) aren’t dynamically computed or placed to avoid overlaps.

### Proposed fixes
- Add layout parameters (label offsets, min separation, collision avoidance) and derive sensible defaults per widget.
- Implement overlay support (e.g., regression line) where pedagogy demands it.
- Introduce visual QA validators to detect unreadable overlaps or missing required annotations.
