# Which side lengths form a right triangle?

- **analysisId**: 8da7dfc2-f4e7-4f10-8bcb-572e07234fed
- **questionId**: x63d85b85427f288c
- **severity**: major

### Issue
The question "Which side lengths form a right triangle?" is presented twice. The labels for the triangle diagram (i.e., the diagram visually explaining a triangle's hypotenuse and two legs) are improperly place and lead to overlap among each and the triangle's lines. The left "leg" label should be to the left of the triangle line segment and the "hypotenuse" label should be completely to the right of the hypotenuse triangle line segment.

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "We can use the Pythagorean Theorem to see if the side lengths will form a right triangle.\n\nThe equation for the Pythagorean Theorem is \n\n>$a^2 + b^2  = c^2$\n\nwhere $a$ and $b$ are the lengths of the two legs of the triangle, and $c$ is the length of the hypotenuse.\n\n [[☃ explanation 1]]",
      "replace": false,
      "widgets": {
        "explanation 1": {
          "type": "explanation",
          "graded": true,
          "static": false,
          "options": {
            "static": false,
            "widgets": {
              "image 1": {
                "type": "image",
                "graded": true,
                "static": false,
                "options": {
                  "alt": "A right triangle. The base and height are labeled leg. The longest side is labeled hypotenuse.",
                  "box": [
                    200,
                    167
                  ],
                  "range": [
                    [
                      0,
                      10
                    ],
                    [
                      0,
                      10
                    ]
                  ],
                  "title": "",
                  "labels": [],
                  "static": false,
                  "caption": "",
                  "backgroundImage": {
                    "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/1fe06036222ca425cd0c672984225e31aa509700",
                    "width": 200,
                    "height": 167
                  }
                },
                "version": {
                  "major": 0,
                  "minor": 0
                },
                "alignment": "block"
              }
            },
            "hidePrompt": "Hide explanation",
            "showPrompt": "How can I tell which side is the hypotenuse?",
            "explanation": "The hypotenuse is the longest side and is  across from the right angle. The two legs are the shorter sides that form the right angle:\n\n\n[[☃ image 1]]\n\n"
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "default"
        }
      }
    },
    {
      "images": {},
      "content": "Let's check each set of numbers:\n\n$\\begin{align} a^2 + b^2 &=  c^2 \\\\\\\\\n3^2 + \\sqrt{27}^2 &\\stackrel{\\large?}{=} 6^2 \\\\\\\\\n9 + 27 &\\stackrel{\\large?}{=} 36 \\\\\\\\\n36 &\\stackrel{\\checkmark}{=} 36\\\\\\\\\n\\end{align}$\n\n\nThe side lengths $3, \\sqrt{27}, 6$ **do** form a right triangle.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "\n\n$\\begin{align} a^2 + b^2 &=  c^2 \\\\\\\\\n8^2 + 15^2 &\\stackrel{\\large?}{=} 17^2 \\\\\\\\\n64 + 225 &\\stackrel{\\large?}{=} 289 \\\\\\\\\n289 &\\stackrel{\\checkmark}{=} 289\\\\\\\\\n\\end{align}$\n\n\nThe side lengths $8, 15, 17$ **do** form a right triangle.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "$\\begin{align} a^2 + b^2 &=  c^2 \\\\\\\\\n5^2 + 5^2 &\\stackrel{\\large?}{=} \\sqrt{50}^2 \\\\\\\\\n25 + 25 &\\stackrel{\\large?}{=} 50 \\\\\\\\\n50 &\\stackrel{\\checkmark}{=} 50\\\\\\\\\n\\end{align}$\n\nThe side lengths $5, 5, \\sqrt{50}$ **do** form a right triangle.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "The side lengths that form a right triangle are:    \n\n$3, \\sqrt{27}, 6$   \n$8, 15, 17$  \n $5, 5, \\sqrt{50}$\n",
      "replace": false,
      "widgets": {}
    }
  ],
  "question": {
    "images": {},
    "content": "**Which side lengths form a right triangle?**\n\n[[☃ radio 1]]",
    "widgets": {
      "radio 1": {
        "type": "radio",
        "graded": true,
        "static": false,
        "options": {
          "choices": [
            {
              "content": "$3, \\sqrt{27}, 6$",
              "correct": true
            },
            {
              "content": "$8, 15, 17$",
              "correct": true
            },
            {
              "content": "$5, 5, \\sqrt{50}$",
              "correct": true,
              "isNoneOfTheAbove": false
            }
          ],
          "randomize": false,
          "onePerLine": true,
          "displayCount": null,
          "multipleSelect": true,
          "deselectEnabled": false,
          "hasNoneOfTheAbove": false
        },
        "version": {
          "major": 1,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Which side lengths form a right triangle?"
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "choice_interaction"
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "We can use the Pythagorean Theorem to see if a set of side lengths will form a right triangle."
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "The equation for the Pythagorean Theorem is "
        },
        {
          "type": "math",
          "mathml": "<msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup>"
        },
        {
          "type": "text",
          "content": ", where "
        },
        {
          "type": "math",
          "mathml": "<mi>a</mi>"
        },
        {
          "type": "text",
          "content": " and "
        },
        {
          "type": "math",
          "mathml": "<mi>b</mi>"
        },
        {
          "type": "text",
          "content": " are the lengths of the two legs, and "
        },
        {
          "type": "math",
          "mathml": "<mi>c</mi>"
        },
        {
          "type": "text",
          "content": " is the length of the hypotenuse."
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "How can I tell which side is the hypotenuse?"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "The hypotenuse is the longest side and is across from the right angle. The two legs are the shorter sides that form the right angle:"
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "right_triangle_image"
    }
  ],
  "title": "Which side lengths form a right triangle?",
  "widgets": {
    "right_triangle_image": {
      "type": "triangleDiagram",
      "sides": [
        {
          "label": "leg",
          "vertices": [
            "A",
            "B"
          ],
          "tickMarks": 0
        },
        {
          "label": "leg",
          "vertices": [
            "A",
            "C"
          ],
          "tickMarks": 0
        },
        {
          "label": "hypotenuse",
          "vertices": [
            "B",
            "C"
          ],
          "tickMarks": 0
        }
      ],
      "width": 200,
      "angles": [
        {
          "color": "",
          "label": "",
          "radius": 14,
          "showArc": true,
          "vertices": [
            "B",
            "A",
            "C"
          ],
          "isRightAngle": true
        }
      ],
      "height": 166.6667,
      "points": [
        {
          "x": 33.3333,
          "y": 133.333,
          "id": "A",
          "label": ""
        },
        {
          "x": 33.3333,
          "y": 33.3333,
          "id": "B",
          "label": ""
        },
        {
          "x": 166.667,
          "y": 133.333,
          "id": "C",
          "label": ""
        }
      ],
      "internalLines": null,
      "shadedRegions": null
    }
  },
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Correct! Each of the following sets satisfies the Pythagorean Theorem and forms a right triangle:"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>3</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<msqrt><mn>27</mn></msqrt>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>6</mn>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>8</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>15</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>17</mn>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>5</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>5</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<msqrt><mn>50</mn></msqrt>"
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Not quite. Use the Pythagorean Theorem to test each set: the side lengths form a right triangle if"
          },
          {
            "type": "text",
            "content": " "
          },
          {
            "type": "math",
            "mathml": "<msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup>"
          },
          {
            "type": "text",
            "content": ", where "
          },
          {
            "type": "math",
            "mathml": "<mi>c</mi>"
          },
          {
            "type": "text",
            "content": " is the longest side (the hypotenuse)."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Example check:"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<msup><mn>3</mn><mn>2</mn></msup><mo>+</mo><msup><mrow><msqrt><mn>27</mn></msqrt></mrow><mn>2</mn></msup><mover><mo>=</mo><mo>?</mo></mover><msup><mn>6</mn><mn>2</mn></msup>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>9</mn><mo>+</mo><mn>27</mn><mover><mo>=</mo><mo>?</mo></mover><mn>36</mn>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>36</mn><mover><mo>=</mo><mo>✓</mo></mover><mn>36</mn>"
          }
        ]
      }
    ]
  },
  "identifier": "which-side-lengths-form-a-right-triangle",
  "interactions": {
    "choice_interaction": {
      "type": "choiceInteraction",
      "prompt": [
        {
          "type": "text",
          "content": "Which side lengths form a right triangle?"
        }
      ],
      "choices": [
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "math",
                  "mathml": "<mn>3</mn>"
                },
                {
                  "type": "text",
                  "content": ", "
                },
                {
                  "type": "math",
                  "mathml": "<msqrt><mn>27</mn></msqrt>"
                },
                {
                  "type": "text",
                  "content": ", "
                },
                {
                  "type": "math",
                  "mathml": "<mn>6</mn>"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "A"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "math",
                  "mathml": "<mn>8</mn>"
                },
                {
                  "type": "text",
                  "content": ", "
                },
                {
                  "type": "math",
                  "mathml": "<mn>15</mn>"
                },
                {
                  "type": "text",
                  "content": ", "
                },
                {
                  "type": "math",
                  "mathml": "<mn>17</mn>"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "B"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "math",
                  "mathml": "<mn>5</mn>"
                },
                {
                  "type": "text",
                  "content": ", "
                },
                {
                  "type": "math",
                  "mathml": "<mn>5</mn>"
                },
                {
                  "type": "text",
                  "content": ", "
                },
                {
                  "type": "math",
                  "mathml": "<msqrt><mn>50</mn></msqrt>"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "C"
        }
      ],
      "shuffle": true,
      "maxChoices": 3,
      "minChoices": 1,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": [
        "A",
        "B",
        "C"
      ],
      "baseType": "identifier",
      "identifier": "RESPONSE",
      "cardinality": "multiple"
    }
  ]
}
```

### Relevant code
- Widget registry — src/lib/widgets/generators/index.ts
```
import { generateVennDiagram, VennDiagramPropsSchema } from "./venn-diagram"
import { generateVerticalArithmeticSetup, VerticalArithmeticSetupPropsSchema } from "./vertical-arithmetic-setup"

// The `type` field is now included in the base schemas, so we remove .extend()
export const typedSchemas = {
	"3dIntersectionDiagram": ThreeDIntersectionDiagramPropsSchema,
	absoluteValueNumberLine: AbsoluteValueNumberLinePropsSchema,
	angleDiagram: AngleDiagramPropsSchema,
	barChart: BarChartPropsSchema,
	boxGrid: BoxGridPropsSchema,
	boxPlot: BoxPlotPropsSchema,
	circleDiagram: CircleDiagramPropsSchema,
	compositeShapeDiagram: CompositeShapeDiagramPropsSchema,
	coordinatePlane: CoordinatePlaneComprehensivePropsSchema,
	distanceFormulaGraph: DistanceFormulaGraphPropsSchema,
	functionPlotGraph: FunctionPlotGraphPropsSchema,
	lineEquationGraph: LineEquationGraphPropsSchema,
	pointPlotGraph: PointPlotGraphPropsSchema,
	polygonGraph: PolygonGraphPropsSchema,
	shapeTransformationGraph: ShapeTransformationGraphPropsSchema,
	dataTable: DataTablePropsSchema,
	discreteObjectRatioDiagram: DiscreteObjectRatioDiagramPropsSchema,
	dotPlot: DotPlotPropsSchema,
	doubleNumberLine: DoubleNumberLinePropsSchema,
	emojiImage: EmojiImagePropsSchema,
	figureComparisonDiagram: FigureComparisonDiagramPropsSchema,
	fractionNumberLine: FractionNumberLinePropsSchema,
	geometricSolidDiagram: GeometricSolidDiagramPropsSchema,
	hangerDiagram: HangerDiagramPropsSchema,
	histogram: HistogramPropsSchema,
	inequalityNumberLine: InequalityNumberLinePropsSchema,
	numberLine: NumberLinePropsSchema,
	numberLineForOpposites: NumberLineForOppositesPropsSchema,
	numberLineWithAction: NumberLineWithActionPropsSchema,
	numberLineWithFractionGroups: NumberLineWithFractionGroupsPropsSchema,
	numberSetDiagram: NumberSetDiagramPropsSchema,
	partitionedShape: PartitionedShapePropsSchema,
	pentagonIntersectionDiagram: PentagonIntersectionDiagramPropsSchema,
	pictograph: PictographPropsSchema,
	polyhedronDiagram: PolyhedronDiagramPropsSchema,
	probabilitySpinner: ProbabilitySpinnerPropsSchema,
	polyhedronNetDiagram: PolyhedronNetDiagramPropsSchema,
	pythagoreanProofDiagram: PythagoreanProofDiagramPropsSchema,
	ratioBoxDiagram: RatioBoxDiagramPropsSchema,
	rectangularFrameDiagram: RectangularFrameDiagramPropsSchema,
	scaleCopiesSlider: ScaleCopiesSliderPropsSchema,
```

- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```

### Root cause analysis
- Widget generators lack fine-grained layout controls for label spacing, tick sizing, and overlays (e.g., best-fit lines).
- Some required annotations (e.g., heights, arcs) aren’t dynamically computed or placed to avoid overlaps.

### Proposed fixes
- Add layout parameters (label offsets, min separation, collision avoidance) and derive sensible defaults per widget.
- Implement overlay support (e.g., regression line) where pedagogy demands it.
- Introduce visual QA validators to detect unreadable overlaps or missing required annotations.
