# Draw a square face to scale on a grid

- **analysisId**: 343c140b-39e5-4924-9f5d-1f4c8b3296da
- **questionId**: x63d0f3e2dac95aee
- **severity**: major

### Issue
The question requires an interaction widget which is not available.

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "We are given the scale $\\purple{1}\\text{ unit}=\\pink{0.01}\\text{ mm}$. Multiplying the scale by $100$, an equivalent scale would be $\\purple{100}\\text{ units}=\\pink1\\text{ mm}$.  ",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "Using the scale $\\purple{100}\\text{ units}=\\pink{1}\\text{ mm}$, let's   convert ${0.1}\\text{ mm}$ to units.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "$\\qquad\\begin{align} &0.1\\cancel{\\text{ mm}} \\cdot \\dfrac{\\purple{100}\\text{ units}}{\\pink1\\cancel{\\text{ mm}}} \\\\\n&= \\blue{10}\\,\\text{units}\\end{align}$",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "We move the points on the square to create our scale drawing.\n\n[[☃ image 1]]\n\n",
      "replace": false,
      "widgets": {
        "image 1": {
          "type": "image",
          "graded": true,
          "static": false,
          "options": {
            "alt": "A quadrilateral with all sides of equal length labelled as 10 units each. The vertices are marked with filled dots and the sides are at right angles with each other.\n",
            "box": [
              390,
              225
            ],
            "range": [
              [
                0,
                10
              ],
              [
                0,
                10
              ]
            ],
            "title": "",
            "labels": [],
            "static": false,
            "caption": "",
            "backgroundImage": {
              "url": "https://cdn.kastatic.org/ka-perseus-graphie/2974df046247124d2b01482f610b3b87f4d4d693.png",
              "width": 390,
              "height": 225
            }
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "block"
        }
      }
    }
  ],
  "question": {
    "images": {},
    "content": "Mary is a scientist. Using a microscope, she looks at a salt crystal and discovers it is shaped like a cube. Each square face has side length $0.1\\text{ mm}$.\n\n**Draw the crystal's square face such that $1$ unit on the grid below represents $ 0.01\\text{ mm}$.**\n\n[[☃ interactive-graph 1]]",
    "widgets": {
      "interactive-graph 1": {
        "type": "interactive-graph",
        "graded": true,
        "static": false,
        "options": {
          "step": [
            1,
            1
          ],
          "graph": {
            "type": "polygon",
            "numSides": 4,
            "showSides": true
          },
          "range": [
            [
              -10,
              10
            ],
            [
              -10,
              10
            ]
          ],
          "labels": [
            "x",
            "y"
          ],
          "correct": {
            "type": "polygon",
            "match": "congruent",
            "coords": [
              [
                5,
                -6.5
              ],
              [
                5,
                3.5
              ],
              [
                -5,
                3.5
              ],
              [
                -5,
                -6.5
              ]
            ],
            "numSides": 4,
            "showSides": true
          },
          "gridStep": [
            1,
            1
          ],
          "markings": "grid",
          "snapStep": [
            0.5,
            0.5
          ],
          "showRuler": false,
          "rulerLabel": "",
          "rulerTicks": 10,
          "showTooltips": false,
          "showProtractor": false,
          "backgroundImage": {
            "url": "",
            "left": "32",
            "scale": ".16",
            "width": 0,
            "bottom": "37",
            "height": 0
          }
        },
        "version": {
          "major": 0,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Mary is a scientist. Using a microscope, she looks at a salt crystal and discovers it is shaped like a cube. Each square face has side length "
        },
        {
          "type": "math",
          "mathml": "<mn>0.1</mn><mtext> mm</mtext>"
        },
        {
          "type": "text",
          "content": "."
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Draw the crystal's square face such that "
        },
        {
          "type": "math",
          "mathml": "<mn>1</mn><mtext> unit</mtext>"
        },
        {
          "type": "text",
          "content": " on the grid below represents "
        },
        {
          "type": "math",
          "mathml": "<mn>0.01</mn><mtext> mm</mtext>"
        },
        {
          "type": "text",
          "content": "."
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "polygon_draw_interaction"
    }
  ],
  "title": "Draw a square face to scale on a grid",
  "widgets": {},
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Correct! Because "
          },
          {
            "type": "math",
            "mathml": "<mn>1</mn><mtext> unit</mtext><mo>=</mo><mn>0.01</mn><mtext> mm</mtext>"
          },
          {
            "type": "text",
            "content": ", then "
          },
          {
            "type": "math",
            "mathml": "<mn>0.1</mn><mtext> mm</mtext>"
          },
          {
            "type": "text",
            "content": " corresponds to "
          },
          {
            "type": "math",
            "mathml": "<mn>10</mn><mtext> units</mtext>"
          },
          {
            "type": "text",
            "content": ", so a square with side length "
          },
          {
            "type": "math",
            "mathml": "<mn>10</mn><mtext> units</mtext>"
          },
          {
            "type": "text",
            "content": " is correct."
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "We are given the scale "
          },
          {
            "type": "math",
            "mathml": "<mn>1</mn><mtext> unit</mtext><mo>=</mo><mn>0.01</mn><mtext> mm</mtext>"
          },
          {
            "type": "text",
            "content": ". Multiplying the scale by "
          },
          {
            "type": "math",
            "mathml": "<mn>100</mn>"
          },
          {
            "type": "text",
            "content": ", an equivalent scale is "
          },
          {
            "type": "math",
            "mathml": "<mn>100</mn><mtext> units</mtext><mo>=</mo><mn>1</mn><mtext> mm</mtext>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Using this scale, convert "
          },
          {
            "type": "math",
            "mathml": "<mn>0.1</mn><mtext> mm</mtext>"
          },
          {
            "type": "text",
            "content": " to units."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>0.1</mn><mtext> mm</mtext><mo>×</mo><mfrac><mrow><mn>100</mn><mtext> units</mtext></mrow><mrow><mn>1</mn><mtext> mm</mtext></mrow></mfrac><mo>=</mo><mn>10</mn><mtext> units</mtext>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Now draw a square with side length "
          },
          {
            "type": "math",
            "mathml": "<mn>10</mn><mtext> units</mtext>"
          },
          {
            "type": "text",
            "content": " on the grid."
          }
        ]
      }
    ]
  },
  "identifier": "scale-drawing-square-face-graph",
  "interactions": {
    "polygon_draw_interaction": {
      "type": "textEntryInteraction",
      "expectedLength": null,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": "SQUARE_SIDE_10_UNITS_CONGRUENT",
      "baseType": "string",
      "identifier": "RESPONSE",
      "cardinality": "single"
    }
  ]
}
```

### Relevant code
- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```

### Root cause analysis
- Needs manual triage; automatic classifier found no known category.

### Proposed fixes
- Add a targeted test and create a dedicated validator/prompt constraint for this pattern.
