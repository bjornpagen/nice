# Translate a triangle on the coordinate plane

- **analysisId**: c97156c9-a1b3-4a7c-bcc8-cf86995e5376
- **questionId**: x622210c259822d46
- **severity**: major

### Issue
The interaction (i.e., drawing widget interaction) necessary to complete this is not available.

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "To translate $\\triangle ABC$ by $3$ units to the left and $3$ units down, we basically translate $\\triangle ABC$'s vertices and connect them.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "For example, point $\\blueD{C(6,-4)}$ is translated to $\\greenD{(3,-7)}$.\n\n\n[[☃ image 1]]\n\n",
      "replace": false,
      "widgets": {
        "image 1": {
          "type": "image",
          "graded": true,
          "static": false,
          "options": {
            "alt": "A coordinate plane with a triangle with vertices A B C and Vertex A at negative four, three, vertex B at negative two, four, and vertex C at six, negative four. The x- and y- axes scale by one. A dashed line moves from vertex C three units left and three units down to a point at three, negative seven. ",
            "box": [
              325,
              325
            ],
            "range": [
              [
                0,
                10
              ],
              [
                0,
                10
              ]
            ],
            "title": "",
            "labels": [],
            "static": false,
            "caption": "",
            "backgroundImage": {
              "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/95f9e9b46a38d1be4d179f73b843a49fede194aa",
              "width": 325,
              "height": 325
            }
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "block"
        }
      }
    },
    {
      "images": {},
      "content": "Doing this for all vertices and connecting them, we get the following mapping:\n\n\n\n[[☃ image 1]]\n\n",
      "replace": false,
      "widgets": {
        "image 1": {
          "type": "image",
          "graded": true,
          "static": false,
          "options": {
            "alt": "A coordinate plane with a triangle with vertices A B C and Vertex A at negative four, three, vertex B at negative two, four, and vertex C at six, negative four. The x- and y- axes scale by one. A dashed line moves from the three vertices three units left and three units down to form an image of a congruent triangle with vertices at three, negative seven, negative seven, zero and negative five, one.",
            "box": [
              325,
              325
            ],
            "range": [
              [
                0,
                10
              ],
              [
                0,
                10
              ]
            ],
            "title": "",
            "labels": [],
            "static": false,
            "caption": "",
            "backgroundImage": {
              "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/6375fd7fb4b0bbfbc192398cead62a351b77f481",
              "width": 325,
              "height": 325
            }
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "block"
        }
      }
    }
  ],
  "question": {
    "images": {},
    "content": "**Draw the image of $\\triangle ABC$ under a translation by $3$ units to the left and $3$ units down.**\n\n[[☃ interactive-graph 1]]",
    "widgets": {
      "interactive-graph 1": {
        "type": "interactive-graph",
        "graded": true,
        "static": false,
        "options": {
          "step": [
            1,
            1
          ],
          "graph": {
            "type": "polygon",
            "snapTo": "grid",
            "numSides": 3
          },
          "range": [
            [
              -8,
              8
            ],
            [
              -8,
              8
            ]
          ],
          "labels": [
            "x",
            "y"
          ],
          "correct": {
            "type": "polygon",
            "coords": [
              [
                3,
                -7
              ],
              [
                -5,
                1
              ],
              [
                -7,
                0
              ]
            ],
            "snapTo": "grid",
            "numSides": 3
          },
          "gridStep": [
            1,
            1
          ],
          "markings": "none",
          "snapStep": [
            1,
            1
          ],
          "showRuler": false,
          "rulerLabel": "",
          "rulerTicks": 10,
          "showTooltips": false,
          "showProtractor": false,
          "backgroundImage": {
            "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/6d68f4a08a77506cbc4bdea3920255e82b709438",
            "width": 425,
            "height": 425
          }
        },
        "version": {
          "major": 0,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Draw the image of "
        },
        {
          "type": "math",
          "mathml": "<mo>△</mo><mi>A</mi><mi>B</mi><mi>C</mi>"
        },
        {
          "type": "text",
          "content": " under a translation by "
        },
        {
          "type": "math",
          "mathml": "<mn>3</mn>"
        },
        {
          "type": "text",
          "content": " units to the left and "
        },
        {
          "type": "math",
          "mathml": "<mn>3</mn>"
        },
        {
          "type": "text",
          "content": " units down."
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "interactive_graph_1"
    }
  ],
  "title": "Translate a triangle on the coordinate plane",
  "widgets": {},
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Great job! The image of "
          },
          {
            "type": "math",
            "mathml": "<mo>△</mo><mi>A</mi><mi>B</mi><mi>C</mi>"
          },
          {
            "type": "text",
            "content": " under this translation has vertices at "
          },
          {
            "type": "math",
            "mathml": "<mrow><mo>(</mo><mn>3</mn><mo>,</mo><mo>-</mo><mn>7</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mrow><mo>(</mo><mo>-</mo><mn>7</mn><mo>,</mo><mn>0</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": ", and "
          },
          {
            "type": "math",
            "mathml": "<mrow><mo>(</mo><mo>-</mo><mn>5</mn><mo>,</mo><mn>1</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "To translate the triangle, translate each vertex of "
          },
          {
            "type": "math",
            "mathml": "<mo>△</mo><mi>A</mi><mi>B</mi><mi>C</mi>"
          },
          {
            "type": "text",
            "content": " by 3 units left and 3 units down, then connect the new points."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "For example, point "
          },
          {
            "type": "math",
            "mathml": "<mrow><mi>C</mi><mo>(</mo><mn>6</mn><mo>,</mo><mo>-</mo><mn>4</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": " translates to "
          },
          {
            "type": "math",
            "mathml": "<mrow><mo>(</mo><mn>3</mn><mo>,</mo><mo>-</mo><mn>7</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Doing this for all vertices gives the mapping "
          },
          {
            "type": "math",
            "mathml": "<mrow><mi>A</mi><mo>(</mo><mo>-</mo><mn>4</mn><mo>,</mo><mn>3</mn><mo>)</mo><mo>→</mo><mo>(</mo><mo>-</mo><mn>7</mn><mo>,</mo><mn>0</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mrow><mi>B</mi><mo>(</mo><mo>-</mo><mn>2</mn><mo>,</mo><mn>4</mn><mo>)</mo><mo>→</mo><mo>(</mo><mo>-</mo><mn>5</mn><mo>,</mo><mn>1</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mrow><mi>C</mi><mo>(</mo><mn>6</mn><mo>,</mo><mo>-</mo><mn>4</mn><mo>)</mo><mo>→</mo><mo>(</mo><mn>3</mn><mo>,</mo><mo>-</mo><mn>7</mn><mo>)</mo></mrow>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      }
    ]
  },
  "identifier": "translate-triangle-interactive-graph",
  "interactions": {
    "interactive_graph_1": {
      "type": "textEntryInteraction",
      "expectedLength": null,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": "polygon[(3,-7),(-5,1),(-7,0)]",
      "baseType": "string",
      "identifier": "RESPONSE",
      "cardinality": "single"
    }
  ]
}
```

### Relevant code
- Interaction schema (no drawing/graph interactions) — src/lib/qti-generation/schemas.ts
```
// Factory functions to create fresh schema instances (avoids $ref in JSON Schema)
function createInlineContentItemSchema() {
	return z
		.discriminatedUnion("type", [
			z
				.object({
					type: z.literal("text").describe("Identifies this as plain text content"),
					content: z.string().describe("The actual text content to display")
				})
				.strict()
				.describe("Plain text content that will be rendered as-is"),
			z
				.object({
					type: z.literal("math").describe("Identifies this as mathematical content"),
					mathml: z.string().describe("MathML markup for mathematical expressions, without the outer math element")
				})
				.strict()
				.describe("Mathematical content represented in MathML format"),
			z
				.object({
					type: z
						.literal("inlineSlot")
						.describe("Identifies this as an inline placeholder for widgets or interactions"),
					slotId: z.string().describe("Unique identifier that matches a widget or interaction key")
				})
				.strict()
				.describe("Placeholder for inline content that will be filled with a widget or interaction")
		])
		.describe("Union type representing any inline content element")
}

export function createInlineContentSchema() {
	return z
		.array(createInlineContentItemSchema())
		.describe("Array of inline content items that can be rendered within a paragraph or prompt")
}

export const InlineContentSchema = createInlineContentSchema()
export type InlineContent = z.infer<typeof InlineContentSchema>

// LEVEL 1: BLOCK CONTENT (for body, feedback, choice content, etc.)
// Factory functions for block content
function createBlockContentItemSchema() {
	return z
		.discriminatedUnion("type", [
			z
```

- Widget typedSchemas (static widgets) — src/lib/widgets/generators/index.ts
```
import { generateVennDiagram, VennDiagramPropsSchema } from "./venn-diagram"
import { generateVerticalArithmeticSetup, VerticalArithmeticSetupPropsSchema } from "./vertical-arithmetic-setup"

// The `type` field is now included in the base schemas, so we remove .extend()
export const typedSchemas = {
	"3dIntersectionDiagram": ThreeDIntersectionDiagramPropsSchema,
	absoluteValueNumberLine: AbsoluteValueNumberLinePropsSchema,
	angleDiagram: AngleDiagramPropsSchema,
	barChart: BarChartPropsSchema,
	boxGrid: BoxGridPropsSchema,
	boxPlot: BoxPlotPropsSchema,
	circleDiagram: CircleDiagramPropsSchema,
	compositeShapeDiagram: CompositeShapeDiagramPropsSchema,
	coordinatePlane: CoordinatePlaneComprehensivePropsSchema,
	distanceFormulaGraph: DistanceFormulaGraphPropsSchema,
	functionPlotGraph: FunctionPlotGraphPropsSchema,
	lineEquationGraph: LineEquationGraphPropsSchema,
	pointPlotGraph: PointPlotGraphPropsSchema,
	polygonGraph: PolygonGraphPropsSchema,
	shapeTransformationGraph: ShapeTransformationGraphPropsSchema,
	dataTable: DataTablePropsSchema,
	discreteObjectRatioDiagram: DiscreteObjectRatioDiagramPropsSchema,
	dotPlot: DotPlotPropsSchema,
	doubleNumberLine: DoubleNumberLinePropsSchema,
	emojiImage: EmojiImagePropsSchema,
	figureComparisonDiagram: FigureComparisonDiagramPropsSchema,
	fractionNumberLine: FractionNumberLinePropsSchema,
	geometricSolidDiagram: GeometricSolidDiagramPropsSchema,
	hangerDiagram: HangerDiagramPropsSchema,
	histogram: HistogramPropsSchema,
	inequalityNumberLine: InequalityNumberLinePropsSchema,
	numberLine: NumberLinePropsSchema,
	numberLineForOpposites: NumberLineForOppositesPropsSchema,
	numberLineWithAction: NumberLineWithActionPropsSchema,
	numberLineWithFractionGroups: NumberLineWithFractionGroupsPropsSchema,
	numberSetDiagram: NumberSetDiagramPropsSchema,
	partitionedShape: PartitionedShapePropsSchema,
	pentagonIntersectionDiagram: PentagonIntersectionDiagramPropsSchema,
	pictograph: PictographPropsSchema,
	polyhedronDiagram: PolyhedronDiagramPropsSchema,
	probabilitySpinner: ProbabilitySpinnerPropsSchema,
	polyhedronNetDiagram: PolyhedronNetDiagramPropsSchema,
	pythagoreanProofDiagram: PythagoreanProofDiagramPropsSchema,
	ratioBoxDiagram: RatioBoxDiagramPropsSchema,
	rectangularFrameDiagram: RectangularFrameDiagramPropsSchema,
	scaleCopiesSlider: ScaleCopiesSliderPropsSchema,
```

- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```
