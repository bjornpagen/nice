# Create a histogram from game scores

- **analysisId**: bf1c3154-6a93-4b81-89a3-6e0c2436ad14
- **questionId**: x627968a38574864b
- **severity**: major

### Issue
This problem requires an interaction widget (i.e., a widget to create histograms) that does not exist.

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "There were $\\blue2$ games where the team scored $\\pink{1}$ to $\\pink{15}$ points.\n\nNumber of points|Data points |Number of games\n:-: | :-: | :-:\n$\\pink{1-15}$ |  $3,10$ | $\\blue2$\n$16-30$ |  $?$ | $?$\n$31-45$ |  $?$ | $?$\n",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "Number of points|Data points |Number of games\n:-: | :-: | :-:\n$1-15$ |  $3,10$ | $2 $\n$16-30$ |  $17,23,28$ | $3 $\n$31-45$ |  $33,42$ | $2$",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {
        "https://cdn.kastatic.org/ka-perseus-images/2140066e6b77fd5b5fe295f990fb7b5e6dca9d46.png": {
          "width": 431,
          "height": 360
        }
      },
      "content": "![A histogram has a horizontal axis, marked from 0 to 45, grouped in increments of 15. The vertical axis is marked from 0 to 5, in increments of 1. Bar heights are approximately as follows. From 0 to 15, 2. From 15 to 30, 3. From 30 to 45, 2.](https://cdn.kastatic.org/ka-perseus-images/2140066e6b77fd5b5fe295f990fb7b5e6dca9d46.png)",
      "replace": false,
      "widgets": {}
    }
  ],
  "question": {
    "images": {},
    "content": "The following data points represent the number of points the Hawaii Eagles football team scored each game.\n\n$\\qquad17,33,28,23,10,42,3$\n\n**Using the data, create a histogram.**\n\n[[☃ plotter 1]]\n\n\n\n\n\n",
    "widgets": {
      "plotter 1": {
        "type": "plotter",
        "graded": true,
        "static": false,
        "options": {
          "maxY": 5,
          "type": "histogram",
          "labels": [
            "Number of points",
            "Number of games"
          ],
          "scaleY": 1,
          "correct": [
            2,
            3,
            2
          ],
          "starting": [
            0,
            0,
            0
          ],
          "categories": [
            "$0$",
            "$15$",
            "$30$",
            "$45$"
          ],
          "snapsPerLine": 1,
          "labelInterval": null
        },
        "version": {
          "major": 0,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "The following data points represent the number of points the Hawaii Eagles football team scored each game."
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "math",
          "mathml": "<mn>17</mn>"
        },
        {
          "type": "text",
          "content": ", "
        },
        {
          "type": "math",
          "mathml": "<mn>33</mn>"
        },
        {
          "type": "text",
          "content": ", "
        },
        {
          "type": "math",
          "mathml": "<mn>28</mn>"
        },
        {
          "type": "text",
          "content": ", "
        },
        {
          "type": "math",
          "mathml": "<mn>23</mn>"
        },
        {
          "type": "text",
          "content": ", "
        },
        {
          "type": "math",
          "mathml": "<mn>10</mn>"
        },
        {
          "type": "text",
          "content": ", "
        },
        {
          "type": "math",
          "mathml": "<mn>42</mn>"
        },
        {
          "type": "text",
          "content": ", "
        },
        {
          "type": "math",
          "mathml": "<mn>3</mn>"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Using the data, create a histogram."
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "histogram_interaction"
    }
  ],
  "title": "Create a histogram from game scores",
  "widgets": {},
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Correct! The histogram should have bin counts "
          },
          {
            "type": "math",
            "mathml": "<mn>2</mn>"
          },
          {
            "type": "text",
            "content": " for "
          },
          {
            "type": "math",
            "mathml": "<mn>0</mn><mo>-</mo><mn>15</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>3</mn>"
          },
          {
            "type": "text",
            "content": " for "
          },
          {
            "type": "math",
            "mathml": "<mn>15</mn><mo>-</mo><mn>30</mn>"
          },
          {
            "type": "text",
            "content": ", and "
          },
          {
            "type": "math",
            "mathml": "<mn>2</mn>"
          },
          {
            "type": "text",
            "content": " for "
          },
          {
            "type": "math",
            "mathml": "<mn>30</mn><mo>-</mo><mn>45</mn>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Not quite. Count how many scores fall in each interval."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>1</mn><mo>-</mo><mn>15</mn>"
          },
          {
            "type": "text",
            "content": ": "
          },
          {
            "type": "math",
            "mathml": "<mn>3</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>10</mn>"
          },
          {
            "type": "text",
            "content": " ("
          },
          {
            "type": "math",
            "mathml": "<mn>2</mn>"
          },
          {
            "type": "text",
            "content": " scores); "
          },
          {
            "type": "math",
            "mathml": "<mn>16</mn><mo>-</mo><mn>30</mn>"
          },
          {
            "type": "text",
            "content": ": "
          },
          {
            "type": "math",
            "mathml": "<mn>17</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>23</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>28</mn>"
          },
          {
            "type": "text",
            "content": " ("
          },
          {
            "type": "math",
            "mathml": "<mn>3</mn>"
          },
          {
            "type": "text",
            "content": " scores); "
          },
          {
            "type": "math",
            "mathml": "<mn>31</mn><mo>-</mo><mn>45</mn>"
          },
          {
            "type": "text",
            "content": ": "
          },
          {
            "type": "math",
            "mathml": "<mn>33</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>42</mn>"
          },
          {
            "type": "text",
            "content": " ("
          },
          {
            "type": "math",
            "mathml": "<mn>2</mn>"
          },
          {
            "type": "text",
            "content": " scores)."
          }
        ]
      }
    ]
  },
  "identifier": "create-histogram-hawaii-eagles",
  "interactions": {
    "histogram_interaction": {
      "type": "textEntryInteraction",
      "expectedLength": null,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": [
        2,
        3,
        2
      ],
      "baseType": "integer",
      "identifier": "RESPONSE",
      "cardinality": "ordered"
    }
  ]
}
```

### Relevant code
- Interaction schema (no drawing/graph interactions) — src/lib/qti-generation/schemas.ts
```
// Factory functions to create fresh schema instances (avoids $ref in JSON Schema)
function createInlineContentItemSchema() {
	return z
		.discriminatedUnion("type", [
			z
				.object({
					type: z.literal("text").describe("Identifies this as plain text content"),
					content: z.string().describe("The actual text content to display")
				})
				.strict()
				.describe("Plain text content that will be rendered as-is"),
			z
				.object({
					type: z.literal("math").describe("Identifies this as mathematical content"),
					mathml: z.string().describe("MathML markup for mathematical expressions, without the outer math element")
				})
				.strict()
				.describe("Mathematical content represented in MathML format"),
			z
				.object({
					type: z
						.literal("inlineSlot")
						.describe("Identifies this as an inline placeholder for widgets or interactions"),
					slotId: z.string().describe("Unique identifier that matches a widget or interaction key")
				})
				.strict()
				.describe("Placeholder for inline content that will be filled with a widget or interaction")
		])
		.describe("Union type representing any inline content element")
}

export function createInlineContentSchema() {
	return z
		.array(createInlineContentItemSchema())
		.describe("Array of inline content items that can be rendered within a paragraph or prompt")
}

export const InlineContentSchema = createInlineContentSchema()
export type InlineContent = z.infer<typeof InlineContentSchema>

// LEVEL 1: BLOCK CONTENT (for body, feedback, choice content, etc.)
// Factory functions for block content
function createBlockContentItemSchema() {
	return z
		.discriminatedUnion("type", [
			z
```

- Widget typedSchemas (static widgets) — src/lib/widgets/generators/index.ts
```
import { generateVennDiagram, VennDiagramPropsSchema } from "./venn-diagram"
import { generateVerticalArithmeticSetup, VerticalArithmeticSetupPropsSchema } from "./vertical-arithmetic-setup"

// The `type` field is now included in the base schemas, so we remove .extend()
export const typedSchemas = {
	"3dIntersectionDiagram": ThreeDIntersectionDiagramPropsSchema,
	absoluteValueNumberLine: AbsoluteValueNumberLinePropsSchema,
	angleDiagram: AngleDiagramPropsSchema,
	barChart: BarChartPropsSchema,
	boxGrid: BoxGridPropsSchema,
	boxPlot: BoxPlotPropsSchema,
	circleDiagram: CircleDiagramPropsSchema,
	compositeShapeDiagram: CompositeShapeDiagramPropsSchema,
	coordinatePlane: CoordinatePlaneComprehensivePropsSchema,
	distanceFormulaGraph: DistanceFormulaGraphPropsSchema,
	functionPlotGraph: FunctionPlotGraphPropsSchema,
	lineEquationGraph: LineEquationGraphPropsSchema,
	pointPlotGraph: PointPlotGraphPropsSchema,
	polygonGraph: PolygonGraphPropsSchema,
	shapeTransformationGraph: ShapeTransformationGraphPropsSchema,
	dataTable: DataTablePropsSchema,
	discreteObjectRatioDiagram: DiscreteObjectRatioDiagramPropsSchema,
	dotPlot: DotPlotPropsSchema,
	doubleNumberLine: DoubleNumberLinePropsSchema,
	emojiImage: EmojiImagePropsSchema,
	figureComparisonDiagram: FigureComparisonDiagramPropsSchema,
	fractionNumberLine: FractionNumberLinePropsSchema,
	geometricSolidDiagram: GeometricSolidDiagramPropsSchema,
	hangerDiagram: HangerDiagramPropsSchema,
	histogram: HistogramPropsSchema,
	inequalityNumberLine: InequalityNumberLinePropsSchema,
	numberLine: NumberLinePropsSchema,
	numberLineForOpposites: NumberLineForOppositesPropsSchema,
	numberLineWithAction: NumberLineWithActionPropsSchema,
	numberLineWithFractionGroups: NumberLineWithFractionGroupsPropsSchema,
	numberSetDiagram: NumberSetDiagramPropsSchema,
	partitionedShape: PartitionedShapePropsSchema,
	pentagonIntersectionDiagram: PentagonIntersectionDiagramPropsSchema,
	pictograph: PictographPropsSchema,
	polyhedronDiagram: PolyhedronDiagramPropsSchema,
	probabilitySpinner: ProbabilitySpinnerPropsSchema,
	polyhedronNetDiagram: PolyhedronNetDiagramPropsSchema,
	pythagoreanProofDiagram: PythagoreanProofDiagramPropsSchema,
	ratioBoxDiagram: RatioBoxDiagramPropsSchema,
	rectangularFrameDiagram: RectangularFrameDiagramPropsSchema,
	scaleCopiesSlider: ScaleCopiesSliderPropsSchema,
```

- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```

### Root cause analysis
- Structured interaction schema only supports choice/inlineChoice/textEntry/order; drawing/plotting interactions are absent.
- Widget generators provide static diagrams only; there is no interactive tool parity for Perseus plotter/grapher widgets.

### Proposed fixes
- Extend interaction schema and compiler to support drawing/graph interactions, with proper response processing.
- If parity is out of scope, transform these items into visual-choice with multiple rendered widgets; enforce answerability via validator.
- Add a pre-compile gate that fails unanswerable items (no supported interaction) with structured logging.
