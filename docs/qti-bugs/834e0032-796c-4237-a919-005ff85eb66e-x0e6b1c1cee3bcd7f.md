# Which side lengths form a right triangle?

- **analysisId**: 834e0032-796c-4237-a919-005ff85eb66e
- **questionId**: x0e6b1c1cee3bcd7f
- **severity**: major

### Issue
reveals answer in the body

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "We can use the Pythagorean Theorem to see if the side lengths will form a right triangle.\n\nThe equation for the Pythagorean Theorem is \n\n>$a^2 + b^2  = c^2$\n\nwhere $a$ and $b$ are the lengths of the two legs of the triangle, and $c$ is the length of the hypotenuse.\n\n [[☃ explanation 1]]",
      "replace": false,
      "widgets": {
        "explanation 1": {
          "type": "explanation",
          "graded": true,
          "static": false,
          "options": {
            "static": false,
            "widgets": {
              "image 1": {
                "type": "image",
                "graded": true,
                "static": false,
                "options": {
                  "alt": "A right triangle. The base and height are labeled leg. The longest side is labeled hypotenuse.",
                  "box": [
                    200,
                    167
                  ],
                  "range": [
                    [
                      0,
                      10
                    ],
                    [
                      0,
                      10
                    ]
                  ],
                  "title": "",
                  "labels": [],
                  "static": false,
                  "caption": "",
                  "backgroundImage": {
                    "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/1fe06036222ca425cd0c672984225e31aa509700",
                    "width": 200,
                    "height": 167
                  }
                },
                "version": {
                  "major": 0,
                  "minor": 0
                },
                "alignment": "block"
              }
            },
            "hidePrompt": "Hide explanation",
            "showPrompt": "How can I tell which side is the hypotenuse?",
            "explanation": "The hypotenuse is the longest side and is  across from the right angle. The two legs are the shorter sides that form the right angle:\n\n\n\n[[☃ image 1]]\n\n"
          },
          "version": {
            "major": 0,
            "minor": 0
          },
          "alignment": "default"
        }
      }
    },
    {
      "images": {},
      "content": "\n\n$\\begin{align} a^2 + b^2 &=  c^2 \\\\\\\\\n3^2 + 6^2 &\\stackrel{\\large?}{=} \\sqrt{45}^2 \\\\\\\\\n9 + 36 &\\stackrel{\\large?}{=} 45 \\\\\\\\\n45 &\\stackrel{\\checkmark}{=} 45\\\\\\\\\n\\end{align}$\n\n\nThe side lengths $3, 6, \\sqrt{45}$ **do** form a right triangle.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "Let's check each set of numbers:\n\n$\\begin{align} a^2 + b^2 &=  c^2 \\\\\\\\\n2.5^2 + 6^2 &\\stackrel{\\large?}{=} 6.5^2 \\\\\\\\\n6.25 + 36 &\\stackrel{\\large?}{=} 42.25 \\\\\\\\\n42.25 &\\stackrel{\\checkmark}{=} 42.25\\\\\\\\\n\\end{align}$\n\n\nThe side lengths $2.5, 6, 6.5$ **do** form a right triangle.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "$\\begin{align} a^2 + b^2 &=  c^2 \\\\\\\\\n4^2 + 8^2 &\\stackrel{\\large?}{=} \\sqrt{80}^2 \\\\\\\\\n16 + 64 &\\stackrel{\\large?}{=} 80 \\\\\\\\\n80 &\\stackrel{\\checkmark}{=} 80\\\\\\\\\n\\end{align}$\n\nThe side lengths $4, 8, \\sqrt{80}$ **do ** form a right triangle.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "The side lengths that form a right triangle are:   \n\n$3, 6, \\sqrt{45}$  \n$2.5, 6, 6.5$   \n$4, 8, \\sqrt{80}$.",
      "replace": false,
      "widgets": {}
    }
  ],
  "question": {
    "images": {},
    "content": "**Which side lengths form a right triangle?**\n\n[[☃ radio 1]]",
    "widgets": {
      "radio 1": {
        "type": "radio",
        "graded": true,
        "static": false,
        "options": {
          "choices": [
            {
              "content": "$3, 6, \\sqrt{45}$",
              "correct": true
            },
            {
              "content": "$\\text{2.5, 6, 6.5}$",
              "correct": true
            },
            {
              "content": "$4, 8, \\sqrt{80}$",
              "correct": true,
              "isNoneOfTheAbove": false
            }
          ],
          "randomize": false,
          "countChoices": false,
          "displayCount": null,
          "multipleSelect": true,
          "deselectEnabled": false,
          "hasNoneOfTheAbove": false
        },
        "version": {
          "major": 1,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "We can use the Pythagorean Theorem to see if side lengths will form a right triangle. The equation for the Pythagorean Theorem is "
        },
        {
          "type": "math",
          "mathml": "<msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup>"
        },
        {
          "type": "text",
          "content": " where "
        },
        {
          "type": "math",
          "mathml": "<mi>a</mi>"
        },
        {
          "type": "text",
          "content": " and "
        },
        {
          "type": "math",
          "mathml": "<mi>b</mi>"
        },
        {
          "type": "text",
          "content": " are the lengths of the legs, and "
        },
        {
          "type": "math",
          "mathml": "<mi>c</mi>"
        },
        {
          "type": "text",
          "content": " is the length of the hypotenuse."
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "The hypotenuse is the longest side and is across from the right angle. The two legs are the shorter sides that form the right angle:"
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "hypotenuse_image"
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Which side lengths form a right triangle? Select all that apply."
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "choice_interaction"
    }
  ],
  "title": "Which side lengths form a right triangle?",
  "widgets": {
    "hypotenuse_image": {
      "type": "triangleDiagram",
      "sides": [
        {
          "label": "leg",
          "vertices": [
            "A",
            "B"
          ],
          "tickMarks": 0
        },
        {
          "label": "leg",
          "vertices": [
            "A",
            "C"
          ],
          "tickMarks": 0
        },
        {
          "label": "hypotenuse",
          "vertices": [
            "B",
            "C"
          ],
          "tickMarks": 0
        }
      ],
      "width": 200,
      "angles": [
        {
          "color": "",
          "label": "",
          "radius": 12,
          "showArc": true,
          "vertices": [
            "B",
            "A",
            "C"
          ],
          "isRightAngle": true
        }
      ],
      "height": 166.6667,
      "points": [
        {
          "x": 33.3333,
          "y": 133.333,
          "id": "A",
          "label": ""
        },
        {
          "x": 33.3333,
          "y": 33.3333,
          "id": "B",
          "label": ""
        },
        {
          "x": 166.667,
          "y": 133.333,
          "id": "C",
          "label": ""
        }
      ],
      "internalLines": null,
      "shadedRegions": null
    }
  },
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Correct! These sets satisfy the Pythagorean Theorem: "
          },
          {
            "type": "math",
            "mathml": "<mn>3</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>6</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<msqrt><mn>45</mn></msqrt>"
          },
          {
            "type": "text",
            "content": "; "
          },
          {
            "type": "math",
            "mathml": "<mn>2.5</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>6</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>6.5</mn>"
          },
          {
            "type": "text",
            "content": "; and "
          },
          {
            "type": "math",
            "mathml": "<mn>4</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<mn>8</mn>"
          },
          {
            "type": "text",
            "content": ", "
          },
          {
            "type": "math",
            "mathml": "<msqrt><mn>80</mn></msqrt>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Not quite. Use the Pythagorean Theorem: "
          },
          {
            "type": "math",
            "mathml": "<msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup>"
          },
          {
            "type": "text",
            "content": ". For each set, treat the largest number as "
          },
          {
            "type": "math",
            "mathml": "<mi>c</mi>"
          },
          {
            "type": "text",
            "content": " and check whether the sum of the squares of the two smaller numbers equals the square of the largest."
          }
        ]
      }
    ]
  },
  "identifier": "which-side-lengths-form-right-triangle",
  "interactions": {
    "choice_interaction": {
      "type": "choiceInteraction",
      "prompt": [
        {
          "type": "text",
          "content": "Which side lengths form a right triangle? Select all that apply."
        }
      ],
      "choices": [
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "3, 6, "
                },
                {
                  "type": "math",
                  "mathml": "<msqrt><mn>45</mn></msqrt>"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "A"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "2.5, 6, 6.5"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "B"
        },
        {
          "content": [
            {
              "type": "paragraph",
              "content": [
                {
                  "type": "text",
                  "content": "4, 8, "
                },
                {
                  "type": "math",
                  "mathml": "<msqrt><mn>80</mn></msqrt>"
                }
              ]
            }
          ],
          "feedback": null,
          "identifier": "C"
        }
      ],
      "shuffle": true,
      "maxChoices": 3,
      "minChoices": 1,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": [
        "A",
        "B",
        "C"
      ],
      "baseType": "identifier",
      "identifier": "RESPONSE",
      "cardinality": "multiple"
    }
  ]
}
```

### Relevant code
- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```

### Root cause analysis
- Needs manual triage; automatic classifier found no known category.

### Proposed fixes
- Add a targeted test and create a dedicated validator/prompt constraint for this pattern.
