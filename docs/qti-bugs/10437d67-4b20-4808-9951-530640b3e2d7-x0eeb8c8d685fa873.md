# Triangle inequality: range of a side

- **analysisId**: 10437d67-4b20-4808-9951-530640b3e2d7
- **questionId**: x0eeb8c8d685fa873
- **severity**: minor

### Issue
side x is ambigous, it's inside the triangle and close to both of the non-base sides. should be more left

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "The triangle inequality theorem states that any side of a triangle is always shorter than the sum of the other two sides.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "Therefore the third side must be less than $8.0 + 2.5 = 10.5$",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "By the same theorem, the third side must be also larger than the difference between the other two sides.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "Therefore the third side must be larger than $8.0 - 2.5 = 5.5$",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "So $5.5 < x < 10.5$",
      "replace": false,
      "widgets": {}
    }
  ],
  "question": {
    "images": {},
    "content": "**What is the range of possible sizes for side $x$?**\n\n\n[[☃ image 1]]\n\n[[☃ numeric-input 1]] $< x <$ [[☃ numeric-input 2]]",
    "widgets": {
      "image 1": {
        "type": "image",
        "graded": true,
        "static": false,
        "options": {
          "alt": "A triangle with two of its sides labeled as 8.0 and x. The shortest side is labeled as 2.5.",
          "box": [
            240,
            280
          ],
          "range": [
            [
              0,
              10
            ],
            [
              0,
              10
            ]
          ],
          "title": "",
          "labels": [],
          "static": false,
          "caption": "",
          "backgroundImage": {
            "url": "web+graphie://cdn.kastatic.org/ka-perseus-graphie/0301ee92a856346e41dec023f214a0358f10740d",
            "width": 240,
            "height": 280
          }
        },
        "version": {
          "major": 0,
          "minor": 0
        },
        "alignment": "block"
      },
      "numeric-input 1": {
        "type": "numeric-input",
        "graded": true,
        "static": false,
        "options": {
          "size": "small",
          "static": false,
          "answers": [
            {
              "value": 5.5,
              "status": "correct",
              "strict": false,
              "message": "",
              "maxError": 0,
              "simplify": "required"
            }
          ],
          "labelText": "",
          "coefficient": false
        },
        "version": {
          "major": 0,
          "minor": 0
        },
        "alignment": "default"
      },
      "numeric-input 2": {
        "type": "numeric-input",
        "graded": true,
        "static": false,
        "options": {
          "size": "small",
          "static": false,
          "answers": [
            {
              "value": 10.5,
              "status": "correct",
              "strict": false,
              "message": "",
              "maxError": 0,
              "simplify": "required"
            }
          ],
          "labelText": "",
          "coefficient": false
        },
        "version": {
          "major": 0,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "What is the range of possible sizes for side "
        },
        {
          "type": "math",
          "mathml": "<mi>x</mi>"
        },
        {
          "type": "text",
          "content": "?"
        }
      ]
    },
    {
      "type": "blockSlot",
      "slotId": "triangle_image"
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "inlineSlot",
          "slotId": "lower_bound_entry"
        },
        {
          "type": "text",
          "content": " "
        },
        {
          "type": "math",
          "mathml": "<mo>&lt;</mo>"
        },
        {
          "type": "text",
          "content": " "
        },
        {
          "type": "math",
          "mathml": "<mi>x</mi>"
        },
        {
          "type": "text",
          "content": " "
        },
        {
          "type": "math",
          "mathml": "<mo>&lt;</mo>"
        },
        {
          "type": "text",
          "content": " "
        },
        {
          "type": "inlineSlot",
          "slotId": "upper_bound_entry"
        }
      ]
    }
  ],
  "title": "Triangle inequality: range of a side",
  "widgets": {
    "triangle_image": {
      "type": "triangleDiagram",
      "sides": [
        {
          "label": "2.5",
          "vertices": [
            "A",
            "B"
          ],
          "tickMarks": 0
        },
        {
          "label": "x",
          "vertices": [
            "A",
            "C"
          ],
          "tickMarks": 0
        },
        {
          "label": "8.0",
          "vertices": [
            "B",
            "C"
          ],
          "tickMarks": 0
        }
      ],
      "width": 240,
      "angles": null,
      "height": 280,
      "points": [
        {
          "x": 40,
          "y": 240,
          "id": "A",
          "label": ""
        },
        {
          "x": 112.446,
          "y": 240,
          "id": "B",
          "label": ""
        },
        {
          "x": 167.511,
          "y": 19.1444,
          "id": "C",
          "label": ""
        }
      ],
      "internalLines": null,
      "shadedRegions": null
    }
  },
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Correct! The range is "
          },
          {
            "type": "math",
            "mathml": "<mn>5.5</mn><mo>&lt;</mo><mi>x</mi><mo>&lt;</mo><mn>10.5</mn>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "The triangle inequality theorem states that any side of a triangle is always shorter than the sum of the other two sides."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Therefore the third side must be less than "
          },
          {
            "type": "math",
            "mathml": "<mn>8.0</mn><mo>+</mo><mn>2.5</mn><mo>=</mo><mn>10.5</mn>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "By the same theorem, the third side must also be larger than the difference between the other two sides."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Therefore the third side must be larger than "
          },
          {
            "type": "math",
            "mathml": "<mn>8.0</mn><mo>-</mo><mn>2.5</mn><mo>=</mo><mn>5.5</mn>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "So "
          },
          {
            "type": "math",
            "mathml": "<mn>5.5</mn><mo>&lt;</mo><mi>x</mi><mo>&lt;</mo><mn>10.5</mn>"
          }
        ]
      }
    ]
  },
  "identifier": "triangle-inequality-range-x",
  "interactions": {
    "lower_bound_entry": {
      "type": "textEntryInteraction",
      "expectedLength": 4,
      "responseIdentifier": "RESP_LOWER"
    },
    "upper_bound_entry": {
      "type": "textEntryInteraction",
      "expectedLength": 4,
      "responseIdentifier": "RESP_UPPER"
    }
  },
  "responseDeclarations": [
    {
      "correct": "11/2",
      "baseType": "string",
      "identifier": "RESP_LOWER",
      "cardinality": "single"
    },
    {
      "correct": "21/2",
      "baseType": "string",
      "identifier": "RESP_UPPER",
      "cardinality": "single"
    }
  ]
}
```

### Relevant code
- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```

### Root cause analysis
- Needs manual triage; automatic classifier found no known category.

### Proposed fixes
- Add a targeted test and create a dedicated validator/prompt constraint for this pattern.
