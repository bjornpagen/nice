# Rearrange the equation so q is the independent variable

- **analysisId**: 4f51a68c-53c5-4c0c-a971-e4847a15cbf3
- **questionId**: xff6eab7658ca9cbe
- **severity**: minor

### Issue
answer choices must be wide spread for these type of example. for example (0.625q, (5/8)q, 5/8q) basically covering every single possible answer no matter how it is written

### Perseus (original)
```json
{
  "hints": [
    {
      "images": {},
      "content": "To arrive at a correct equation, we have to solve the equation for $r$.",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "$\\begin{align}-7q+12r&=3q-4r\\\\\\\\\n16r&=10q\\\\\\\\\nr&=\\dfrac{10q}{16}\\\\\\\\\nr&=\\dfrac{5}{8}q\\end{align}$",
      "replace": false,
      "widgets": {}
    },
    {
      "images": {},
      "content": "The following equation is rearranged so $q$ is the independent variable:\n\n$r=\\dfrac{5}{8}q$",
      "replace": false,
      "widgets": {}
    }
  ],
  "question": {
    "images": {},
    "content": "**Rearrange the equation so $q$ is the independent variable.**\n\n$-7q+12r=3q-4r$\n\n$r=$ [[☃ expression 1]]",
    "widgets": {
      "expression 1": {
        "type": "expression",
        "graded": true,
        "static": false,
        "options": {
          "times": false,
          "functions": [
            "f",
            "g",
            "h"
          ],
          "buttonSets": [
            "basic"
          ],
          "answerForms": [
            {
              "key": 0,
              "form": false,
              "value": "0.625q",
              "simplify": false,
              "considered": "correct"
            }
          ]
        },
        "version": {
          "major": 1,
          "minor": 0
        },
        "alignment": "default"
      }
    }
  },
  "answerArea": {
    "tTable": false,
    "zTable": false,
    "chi2Table": false,
    "calculator": false,
    "periodicTable": false
  },
  "itemDataVersion": {
    "major": 0,
    "minor": 1
  }
}
```

### Structured JSON (generated)
```json
{
  "body": [
    {
      "type": "paragraph",
      "content": [
        {
          "type": "text",
          "content": "Rearrange the equation so "
        },
        {
          "type": "math",
          "mathml": "<mi>q</mi>"
        },
        {
          "type": "text",
          "content": " is the independent variable."
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "math",
          "mathml": "<mo>-</mo><mn>7</mn><mi>q</mi><mo>+</mo><mn>12</mn><mi>r</mi><mo>=</mo><mn>3</mn><mi>q</mi><mo>-</mo><mn>4</mn><mi>r</mi>"
        }
      ]
    },
    {
      "type": "paragraph",
      "content": [
        {
          "type": "math",
          "mathml": "<mi>r</mi><mo>=</mo>"
        },
        {
          "type": "inlineSlot",
          "slotId": "expression_entry"
        }
      ]
    }
  ],
  "title": "Rearrange the equation so q is the independent variable",
  "widgets": {},
  "feedback": {
    "correct": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "Correct! Rearranged with "
          },
          {
            "type": "math",
            "mathml": "<mi>q</mi>"
          },
          {
            "type": "text",
            "content": " as the independent variable:"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mi>r</mi><mo>=</mo><mfrac><mn>5</mn><mn>8</mn></mfrac><mi>q</mi>"
          }
        ]
      }
    ],
    "incorrect": [
      {
        "type": "paragraph",
        "content": [
          {
            "type": "text",
            "content": "To arrive at a correct equation, solve for "
          },
          {
            "type": "math",
            "mathml": "<mi>r</mi>"
          },
          {
            "type": "text",
            "content": "."
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mo>-</mo><mn>7</mn><mi>q</mi><mo>+</mo><mn>12</mn><mi>r</mi><mo>=</mo><mn>3</mn><mi>q</mi><mo>-</mo><mn>4</mn><mi>r</mi>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mn>16</mn><mi>r</mi><mo>=</mo><mn>10</mn><mi>q</mi>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mi>r</mi><mo>=</mo><mfrac><mrow><mn>10</mn><mi>q</mi></mrow><mn>16</mn></mfrac>"
          }
        ]
      },
      {
        "type": "paragraph",
        "content": [
          {
            "type": "math",
            "mathml": "<mi>r</mi><mo>=</mo><mfrac><mn>5</mn><mn>8</mn></mfrac><mi>q</mi>"
          }
        ]
      }
    ]
  },
  "identifier": "rearrange-linear-eqn-solve-for-r",
  "interactions": {
    "expression_entry": {
      "type": "textEntryInteraction",
      "expectedLength": 6,
      "responseIdentifier": "RESPONSE"
    }
  },
  "responseDeclarations": [
    {
      "correct": "5q/8",
      "baseType": "string",
      "identifier": "RESPONSE",
      "cardinality": "single"
    }
  ]
}
```

### Relevant code
- Compiler finalization (missing URL hardening) — src/lib/qti-generation/compiler.ts
```
	finalXml = stripXmlComments(finalXml, logger)
	finalXml = removeDoubleNewlines(finalXml, logger)
	finalXml = fixMathMLOperators(finalXml, logger)
	finalXml = fixInequalityOperators(finalXml, logger)
	// Convert HTML entities to Unicode characters at the very end
	return convertHtmlEntities(finalXml, logger)
}

```

### Root cause analysis
- Needs manual triage; automatic classifier found no known category.

### Proposed fixes
- Add a targeted test and create a dedicated validator/prompt constraint for this pattern.
