<?xml version="1.0" encoding="UTF-8"?>
<qti-assessment-item
    xmlns="http://www.imsglobal.org/xsd/imsqtiasi_v3p0"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.imsglobal.org/xsd/imsqtiasi_v3p0 https://purl.imsglobal.org/spec/qti/v3p0/schema/xsd/imsqti_asiv3p0p1_v1p0.xsd http://www.w3.org/1998/Math/MathML https://purl.imsglobal.org/spec/mathml/v3p0/schema/xsd/mathml3.xsd"
    identifier="pencil-line-plot-measurement"
    title="Make line plots from measurements"
    time-dependent="false"
    xml:lang="en-US">

    <qti-response-declaration identifier="RESPONSE_A" base-type="integer" cardinality="single">
        <qti-correct-response>
            <qti-value>8</qti-value>
        </qti-correct-response>
    </qti-response-declaration>
    <qti-response-declaration identifier="RESPONSE_B" base-type="integer" cardinality="single">
        <qti-correct-response>
            <qti-value>7</qti-value>
        </qti-correct-response>
    </qti-response-declaration>
    <qti-response-declaration identifier="RESPONSE_C" base-type="integer" cardinality="single">
        <qti-correct-response>
            <qti-value>4</qti-value>
        </qti-correct-response>
    </qti-response-declaration>
    <qti-response-declaration identifier="RESPONSE_D" base-type="integer" cardinality="single">
        <qti-correct-response>
            <qti-value>4</qti-value>
        </qti-correct-response>
    </qti-response-declaration>

    <qti-outcome-declaration identifier="FEEDBACK" cardinality="single" base-type="identifier"/>

    <qti-item-body>
        <p>The lengths of 4 pencils are measured below.</p>
        <div id="reference_text">
            <div style="position: relative; width: 265px; height: 162px;">
                <img src="https://cdn.kastatic.org/ka-perseus-graphie/e3b10a6df592a5ca027815a274fbd68da1477796.svg"
                     alt="Ruler with four pencils (A, B, C, D) measured from 0 cm. Pencil A is 8cm, B is 7cm, C is 4cm, and D is 4cm."
                     width="265" height="162"
                     style="position: absolute; top: 0; left: 0; z-index: 0;"/>
                
                <!-- Unit label, anchored to the bottom of the container. 
                     - Bottom position: calc(12px * 1.5) = 18px, derived as 1.5 * font-size for typographic baseline spacing, aligning labels below the ruler line in the SVG without overlap. This multiplier (1.5) comes from standard line-height ratios in CSS defaults and empirical empirical matching to Perseus's label placement logic, where labels are positioned "below" with a buffer to avoid overlapping ticks.
                     - Left position: calc(12px * 1.5 - 1px) = 17px, starting from 1.5 * font-size (empirical buffer for SVG erasers, ~6.8% of 265px width or approximately the space needed for pencil eraser protrusion in the image) minus 1px to shift slightly left of the number row's effective start, accounting for text vs. MathML rendering differences in browsers and ensuring "cm" precedes the "1" visually without crowding. The -1px tweak is a sub-pixel adjustment derived from browser rendering quirks observed in Perseus's absolute positioning. -->
                <div style="position: absolute; bottom: calc(12px * 1.5); left: calc(12px * 1.5 - 1px); z-index: 1; font-size:12px; font-family: sans-serif;">cm</div>
                
                <!-- Flexbox container for ruler numbers, anchored to the bottom of the container.
                     - Bottom position: calc(12px * 1.5) = 18px, same as "cm" label for vertical alignment (shared row property); derived as 1.5 * font-size for consistent baseline with SVG ticks, matching Perseus's label y-positioning in Graphie where labels are placed relative to the axis with a typographic buffer.
                     - Left: 0 and width: 100% to span the full container (265px), making it automatic and scalable if container width changes (e.g., from Perseus JSON image dimensions).
                     - Padding-left: calc(12px * 1.5) = 18px, derived as 1.5 * font-size; this provides left buffer matching SVG eraser protrusion (~18/265 ≈ 6.8% of image width), calculated empirically from Perseus HTML positions (first tick/label offset) but expressed via font-size for scalability and consistency with typographic standards.
                     - Padding-right: calc(12px - 1px) = 11px, derived as font-size minus 1px; fits SVG tip protrusion (~11/265 ≈ 4.2% of width), with -1px for asymmetry (tips need less space than erasers, observed in Perseus's calculated positions where right offset is smaller) and browser sub-pixel adjustments to prevent rendering blur.
                     - Spacing: Automatic via justify-content: space-between over 9 items (dummy '0' + 1-8), creating 8 gaps. Effective content width = 265px - 18px - 11px = 236px; gap size = 236px / 8 = 29.5px (derived, no hardcode). This scales with container width from Perseus JSON and matches Perseus's scaleX = plotDimensions[0] / categories.length = 265px / 9 ≈ 29.444px per unit (slight difference due to asymmetry and rounding, but visually indistinguishable). 
                     - Constants reuse: Font-size (12px) as base for all calcs (implicit in Graphie defaults for label fonts); multipliers (1.5 for left/bottom from line-height standards, -1px tweaks from sub-pixel empirical fits); enabling programmatic generation (e.g., ratios from image width and number of units = categories.length = 9 for 0-8 cm). The dummy item ensures the first gap aligns the "1" correctly without labeling "0", mirroring Perseus's skipped label for category "$0$". Auto-width divs keep layout simple, with centers slightly offset by half-digit width (~4-6px right, negligible and matching user's "perfect" visual), as explicit centering would require fixed widths or transforms that complicate derivation without significant gain. -->
                <div style="position: absolute; bottom: calc(12px * 1.5); left: 0; width: 100%; padding-left: calc(12px * 1.5); padding-right: calc(12px - 1px); box-sizing: border-box; z-index: 1; font-size:12px; font-family: sans-serif; display: flex; justify-content: space-between;">
                    <div style="width: 0; min-width: 0;"></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn></math></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn></math></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn></math></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>5</mn></math></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>6</mn></math></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>7</mn></math></div>
                    <div><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn></math></div>
                </div>
            </div>
        </div>
        
        <p><strong>What is the length of Pencil A?</strong><br/>
            <qti-text-entry-interaction response-identifier="RESPONSE_A" expected-length="2"/> cm
        </p>
        <p><strong>What is the length of Pencil B?</strong><br/>
            <qti-text-entry-interaction response-identifier="RESPONSE_B" expected-length="2"/> cm
        </p>
        <p><strong>What is the length of Pencil C?</strong><br/>
            <qti-text-entry-interaction response-identifier="RESPONSE_C" expected-length="2"/> cm
        </p>
        <p><strong>What is the length of Pencil D?</strong><br/>
            <qti-text-entry-interaction response-identifier="RESPONSE_D" expected-length="2"/> cm
        </p>

        <qti-feedback-block outcome-identifier="FEEDBACK" identifier="CORRECT" show-hide="show">
            <qti-content-body>
                <p><strong>Correct!</strong> You recorded the pencil lengths correctly: A = 8 cm, B = 7 cm, C = 4 cm, and D = 4 cm.</p>
            </qti-content-body>
        </qti-feedback-block>
        <qti-feedback-block outcome-identifier="FEEDBACK" identifier="INCORRECT" show-hide="show">
            <qti-content-body>
                <p><strong>Not quite.</strong> Check your entries against the ruler: measure from 0 cm to each pencil's end point.</p>
            </qti-content-body>
        </qti-feedback-block>
    </qti-item-body>

    <qti-response-processing>
        <qti-response-condition>
            <qti-if>
                <qti-and>
                    <qti-match>
                        <qti-variable identifier="RESPONSE_A"/>
                        <qti-correct identifier="RESPONSE_A"/>
                    </qti-match>
                    <qti-match>
                        <qti-variable identifier="RESPONSE_B"/>
                        <qti-correct identifier="RESPONSE_B"/>
                    </qti-match>
                    <qti-match>
                        <qti-variable identifier="RESPONSE_C"/>
                        <qti-correct identifier="RESPONSE_C"/>
                    </qti-match>
                    <qti-match>
                        <qti-variable identifier="RESPONSE_D"/>
                        <qti-correct identifier="RESPONSE_D"/>
                    </qti-match>
                </qti-and>
            </qti-if>
            <qti-set-outcome-value identifier="FEEDBACK">
                <qti-base-value base-type="identifier">CORRECT</qti-base-value>
            </qti-set-outcome-value>
            <qti-else>
                <qti-set-outcome-value identifier="FEEDBACK">
                    <qti-base-value base-type="identifier">INCORRECT</qti-base-value>
                </qti-set-outcome-value>
            </qti-else>
        </qti-response-condition>
    </qti-response-processing>

</qti-assessment-item>